{% extends 'AppMejoraDespacho/base.html' %}
{% load static %}
{%load form_template_extras%}
{% load i18n %}

{% block header %}
<link rel="stylesheet" href="{% static 'css/apprest.css' %}">
<script src="{% static 'js/js_choices.js' %}"></script>
<script src="{% static 'js/js_storage_clear.js' %}"></script>
{% endblock header%}

{% block content %}
<div class="table-responsive table-l">
    <table class="table table-hover table-striped table-image" id="listado">
        <thead>
            <tr class="text-center">
                <th scope="col">NVV</th>
                <th scope="col">Fecha NVV</th>
                <th scope="col">Fecha solicitud</th>
                <th scope="col">RUT cliente</th>
                <th scope="col">Nombre cliente</th>
                <th scope="col">Región</th>
                <th scope="col">Comuna</th>
                <th scope="col">Dirección</th>
                <th scope="col">Nombre contacto</th>
                <th scope="col">Teléfono contacto</th>
                <th scope="col">Condición de pago</th>
                <th scope="col">Observaciones</th>
                <th scope="col">Estado</th>
                <th scope="col">Comprobante de pago</th>
                <th scope="col">Fecha despacho</th>
                <th scope="col">Hora despacho</th>
                <th scope="col">Fecha entrega</th>
                <th scope="col">Observaciones despacho</th>
                <th scope="col">Documento de salida</th>
                <th scope="col">Número</th>
            </tr>
        </thead>
        <tbody>
            {% for item in queryset %}
            <tr class="text-center">
                {% language 'es' %}
                <td>{{ item.nvv }}</td>
                <td>{{ item.fecha_nvv|date:"d F Y" }}</td>
                <td>{{ item.fecha_solicitud|date:"d F Y H:i" }}</td>
                <td>{{ item.rut }}</td>
                <td>{{ item.cliente }}</td>
                <td>{{ regiones|get_region:item.region }}</td>
                <td>{{ comunas|get_comunas_por_region:item.region|get_comuna:item.comuna }}</td>
                <td>{{ item.direccion }}</td>
                <td>{{ item.nombre_contacto }}</td>
                <td>{{ item.telefono_contacto }}</td>
                <td>{{ item.condicion_pago }}</td>
                <td>{{ item.observacion }}</td>
                <td>
                    {% if item.estado == 2 %}
                    Despachado
                    {% elif item.estado == 1 %}
                    Preparado
                    {% else %}
                    En preparación
                    {% endif %}
                </td>
                <td>
                    {% if item.comprobante_pago == "None" %}
                        No hay
                    {% else %}
                        <a href="{{ item.comprobante_pago.url }}" target="_blank">link</a>
                    {% endif %}
                </td>
                <td>{{ item.fecha_despacho|date:"d F Y" }}</td>
                <td>
                    {% if item.hora_despacho_extra_inicio|date:"G" == "0" %}
                        {{ item.hora_de_despacho_inicio }} - {{ item.hora_de_despacho_fin }}
                    {% else %}
                        {{ item.hora_de_despacho_inicio }} - {{ item.hora_de_despacho_fin }}, {{ item.hora_despacho_extra_inicio }} - {{ item.hora_despacho_extra_fin }}
                    {% endif %}
                </td>
                <td>
                    {% if item.fecha_entregado == None %}
                        No entregado
                    {% else %}
                        {{ item.fecha_entregado|date:"d F Y" }}
                    {% endif %}
                </td>
                <td>{{ item.observacion_despacho }}</td>
                <td>
                    {% if item.documento_salida == "None" %}
                        No hay
                    {% else %}
                        <a href="{{ item.documento_salida.url }}" target="_blank">link</a>
                    {% endif %}
                </td>
                {% endlanguage %}
                <td>{{ item.numero }}</td>
            </tr>
            {% endfor %}
            </tbody>
    </table>
</div>
{% endblock content %}