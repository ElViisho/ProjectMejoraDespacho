{% extends 'AppMejoraDespacho/base.html' %}
{% load static %}

{% block header %}
<link rel="stylesheet" href="{% static 'css/apprest.css' %}">
<link rel="stylesheet" href="{% static 'css/apprest_form.css' %}">
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
{% endblock header%}

{% block content %}
<div class="titulo_pagina d-flex justify-content-center">Ingresa una nota de venta</div>
<div class="mensajeAlerta">
	{% if formulario.errors %}
		{% for field in formulario %}
			{% for error in field.errors %}
				<div class="alert alert-danger" role="alert" style="text-align: center; margin-left: 15%; margin-right: 15%;">
					{{ error|escape }}
				</div>
			{% endfor %}
		{% endfor %}
	{% endif %}
</div>
<form class="form" action="" method="POST" enctype="multipart/form-data">
{% csrf_token %}

{% for field in formulario %}
<div class="form-group block-form">
	{% if field.name == "nvv" %}
		<label>{{ field.label }}</label><br>
		<div style="display: none;">{{ field }}</div>
		<select class="js-states form-control js-example-basic-single" id="nvv_selector">
			{% for opt in field %}
				{{ opt }}
			{% endfor %}
		</select>
	{% elif field.name == "comprobante_pago" %}
	<nobr>
		<label>{{ field.label }}</label>
		<label for="id_comprobante_pago" class="custom-file-upload">
		<i class="fa fa-cloud-upload"></i> Subir archivo
		</label> <div id="file_name"></div>
		{{ field }}
	</nobr>
	{% elif field.name == "hora_despacho_inicio" %}
		<label>{{ field.label }}</label><br>
		<div class="selector_hora">{{ field }} {{ formulario.hora_despacho_fin }}</div>
	{% elif field.name == "hora_despacho_fin" %}
	{% else %}
		<label>{{ field.label }}</label><br>
		{{ field }}
	{% endif %}
</div>
{% endfor %}
<input class="btn btn-default" class="boton-sumbit" id="boton" type="submit" value="Subir" readonly>
</form>

<script>
	$(document).ready(function() {
		$('.js-example-basic-single').select2();
	});

	$('#nvv_selector').change(function() {
		var nvv = $(this).val();

		$.ajax({
			success: function () {
				$('#id_nvv').val(nvv);
			}
		})
	})

	$("#id_comprobante_pago").change(function () {
		let file = $(this).val()
		let name = file.split("\\")
    	let nombre = name[name.length-1]
		if (file != null) {
			$('#file_name').html(nombre)
		}
	})
	
	$("#id_region").change(function () {
		var url = "ajax/load-comunas/";
		var regionId = $(this).val();

		$.ajax({
			url: url,
			data: {
				'region': regionId
			},
			success: function (data) {
				$("#id_comuna").html(data);
			}
		});
	});
	if ($("#id_region").val() != 7) {
		var url = "ajax/load-comunas/";
		var regionId = $("#id_region").val();
		var comuna_actual = $("#id_comuna").val();
		$.ajax({
			url: url,
			data: {
				'region': regionId
			},
			success: function (data) {
				$("#id_comuna").html(data),
				$("#id_comuna").val(comuna_actual);
			}
		});
	};
</script>
{% endblock content %}